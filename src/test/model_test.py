import shutil
import unittest
from transformers import pipelines
from sentence_transformers import SentenceTransformer

from src.main.model import ModelQA, ModelST
from src.main.download import download_models
from src.test.resources.constants import TINY_DISTILBERT_MODEL, MODEL_ROOT, PATHS_TO_DOWNLOAD, DATA_TEST_SINGLE_TEXT,\
                                         MODELS_ST, MODELS_QA
from src.test.resources.functions import remove_scores_from_response


class TestModel(unittest.TestCase):

    def test_load_qa_models(self):
        model = {"questionAndAnswer": [TINY_DISTILBERT_MODEL]}
        download_models(PATHS_TO_DOWNLOAD, model)

        model_class = ModelQA(MODEL_ROOT)
        pipelines_, default_pipeline = model_class.load_models()

        self.assertIsInstance(default_pipeline, pipelines.question_answering.QuestionAnsweringPipeline)
        self.assertIsInstance(pipelines_[TINY_DISTILBERT_MODEL], pipelines.question_answering.QuestionAnsweringPipeline)
        shutil.rmtree(MODEL_ROOT)

    def test_load_st_models(self):
        model = {"sentenceTransformer": [TINY_DISTILBERT_MODEL]}
        download_models(PATHS_TO_DOWNLOAD, model)

        model_class = ModelST(MODEL_ROOT)
        pipelines_ = model_class.load_models()

        self.assertIsInstance(pipelines_[TINY_DISTILBERT_MODEL], SentenceTransformer)
        shutil.rmtree(MODEL_ROOT)

    def test_model_get_pipeline_qa(self):
        model = {"questionAndAnswer": [TINY_DISTILBERT_MODEL]}
        download_models(PATHS_TO_DOWNLOAD, model)

        model_class = ModelQA(MODEL_ROOT)
        self.assertIsInstance(model_class.get_pipeline(TINY_DISTILBERT_MODEL),
                              pipelines.question_answering.QuestionAnsweringPipeline)
        shutil.rmtree(MODEL_ROOT)

    def test_model_get_pipeline_st(self):
        model = {"sentenceTransformer": [TINY_DISTILBERT_MODEL]}
        download_models(PATHS_TO_DOWNLOAD, model)

        model_class = ModelST(MODEL_ROOT)
        self.assertIsInstance(model_class.get_pipeline(TINY_DISTILBERT_MODEL), SentenceTransformer)
        shutil.rmtree(MODEL_ROOT)

    def test_model_predict(self):
        download_models(PATHS_TO_DOWNLOAD, MODELS_QA)

        question = "How many games are required to win the FA Cup?"

        answer = [{'start': 693, 'end': 708, 'answer': 'six to fourteen'},
                  {'start': 64, 'end': 66, 'answer': '32'}]

        model_class = ModelQA(MODEL_ROOT)
        response_answer = remove_scores_from_response(
                                model_class.predict(DATA_TEST_SINGLE_TEXT, question, 'deepset/roberta-base-squad2'))
        self.assertEqual(response_answer, answer)
        shutil.rmtree(MODEL_ROOT)

    def test_model_encode(self):
        download_models(PATHS_TO_DOWNLOAD, MODELS_ST)
        answer = "{'id': '123', 'result': [[0.27860432863235474, -0.08736845850944519, -0.3176932632923126, " \
                 "0.4337075352668762, 0.2323848009109497, 0.22227589786052704, 0.6343961954116821, " \
                 "0.1504390835762024, 0.9565765261650085, -0.472080796957016, 0.24544845521450043, " \
                 "0.6529350280761719, 0.04708219692111015, -0.5364431142807007, 0.23559606075286865, " \
                 "-0.4486656188964844, 0.8490979075431824, 0.7101072072982788, -0.03963842988014221, " \
                 "0.6392490863800049, -0.29773277044296265, 0.7828671932220459, 0.26613280177116394, " \
                 "-0.29116344451904297, 0.10138171911239624, -0.19882144033908844, -0.6348930597305298, " \
                 "0.40143662691116333, 1.5339299440383911, -0.33873337507247925, 0.3513730764389038, " \
                 "-1.1893795728683472, 1.1053307056427002, -0.41795995831489563, -0.8966735005378723, " \
                 "-0.2300104796886444, 0.14369136095046997, -0.42762959003448486, -0.01243782602250576, " \
                 "0.4664541482925415, 1.2972983121871948, -0.04608284309506416, -0.2796654999256134, " \
                 "-0.1221662163734436, -0.5723186731338501, 0.2884509265422821, 0.47148990631103516, " \
                 "-0.2905755341053009, 0.8360519409179688, 0.0017986930906772614, 0.7032430768013, " \
                 "1.4536572694778442, 0.21525685489177704, -0.6913400292396545, 0.7887052893638611, " \
                 "1.1978660821914673, -0.29190975427627563, -1.3193434476852417, 0.1096787378191948, " \
                 "-0.4931491017341614, 1.0191408395767212, -0.10160105675458908, -0.883584201335907, " \
                 "0.15294009447097778, 0.5186020731925964, -0.4234560430049896, -0.3046756088733673, " \
                 "0.6936988830566406, 1.3055568933486938, -0.7969715595245361, 0.7543050050735474, " \
                 "-0.8894005417823792, -0.23195619881153107, 1.0603644847869873, 0.20953430235385895, " \
                 "-0.7856623530387878, -0.6603230834007263, -6.8764543533325195, -0.3285389840602875, " \
                 "-0.6290606260299683, -0.7870030999183655, 0.30701160430908203, 1.6131335496902466, " \
                 "0.7383354306221008, 0.3632084131240845, 0.3513360023498535, 0.7798148393630981, 0.5546262860298157, " \
                 "0.18109430372714996, -0.5908699631690979, 0.2839626967906952, 0.7137830257415771, " \
                 "0.4355568587779999, 0.2184777557849884, 1.0069496631622314, -0.10855453461408615, " \
                 "0.15849681198596954, 1.469030499458313, -0.42963072657585144, 0.4160688817501068, " \
                 "-0.049899872392416, 0.1393493264913559, -0.8899377584457397, -0.8171924352645874, " \
                 "-0.6785799264907837, 0.6777400374412537, -0.3248608410358429, -0.10385403037071228, " \
                 "-0.6383185982704163, 0.3582591116428375, 1.004603385925293, 0.6626606583595276, " \
                 "0.08698873221874237, 1.009834885597229, 0.4717550277709961, 0.5464469790458679, " \
                 "0.21797144412994385, -0.33079013228416443, 0.9681633710861206, 0.49612751603126526, " \
                 "0.2673470079898834, -0.16739636659622192, -1.346436619758606, 0.797733724117279, " \
                 "-0.13791313767433167, 0.6926822066307068, 0.5119470953941345, 0.640588104724884, " \
                 "0.07961316406726837, 1.062911868095398, 0.25883975625038147, -1.2569098472595215, " \
                 "-0.32007354497909546, 0.5661720037460327, 0.7417947053909302, 0.9589571952819824, " \
                 "-0.1291925460100174, -0.04486246407032013, 0.5115517377853394, 1.2470476627349854, " \
                 "-0.688060462474823, 1.0840052366256714, -0.3245525360107422, -0.660265326499939, " \
                 "0.7187567353248596, -1.032270073890686, -0.3404017984867096, -0.49196451902389526, " \
                 "1.2348885536193848, -0.176014244556427, -0.36209046840667725, 0.94549959897995, " \
                 "0.08446253091096878, 0.029170634225010872, 0.9828935861587524, -0.46576106548309326, " \
                 "-0.32052287459373474, 1.3329769372940063, 0.8729861378669739, -0.03123454377055168, " \
                 "-0.40021806955337524, -0.2666015028953552, -0.3094390332698822, 0.8859860301017761, " \
                 "0.6763201355934143, -0.21599993109703064, -0.9016857147216797, 0.7885041236877441, " \
                 "0.08566202223300934, -0.014670861884951591, -0.8613147139549255, 1.1207906007766724, " \
                 "-0.25334763526916504, -0.4085371792316437, 0.5534066557884216, 0.46888357400894165, " \
                 "0.051344580948352814, 0.6674420237541199, 0.6913799047470093, 0.4370354115962982, " \
                 "-0.29282641410827637, 0.4271033704280853, -0.8054014444351196, 0.054053619503974915, " \
                 "0.5522798895835876, -0.5138967633247375, 0.14502163231372833, 0.3286735415458679, " \
                 "-0.04476282745599747, -0.7990096211433411, -0.2723892331123352, -0.4420449733734131, " \
                 "-0.10095345228910446, -0.6535765528678894, 0.29186829924583435, 0.6078608632087708, " \
                 "0.2552626430988312, -0.22452250123023987, -0.17888221144676208, -0.03237895295023918, " \
                 "0.9138931035995483, -0.21829478442668915, 1.295511245727539, -0.31068557500839233, " \
                 "-0.08912447094917297, -0.06590472161769867, 0.12099463492631912, -0.4590790271759033, " \
                 "0.5170652270317078, -0.9498469829559326, -0.13085898756980896, -0.09764958918094635, " \
                 "-0.7368414998054504, 0.2449883222579956, -0.633016049861908, -0.04508234187960625, " \
                 "-0.11360251158475876, -1.1847361326217651, -0.9444640874862671, 0.15416565537452698, " \
                 "0.7009246945381165, -1.2424330711364746, 0.31522274017333984, 1.4426509141921997, " \
                 "0.7168453931808472, 0.5320109724998474, 0.04574897512793541, 0.3920314610004425, " \
                 "-0.33116817474365234, -0.5326505899429321, -0.363271027803421, -1.3566100597381592, " \
                 "-1.4617339372634888, 0.6744896173477173, 0.3345867097377777, 2.183049201965332, " \
                 "-0.6510202288627625, -0.2508296072483063, -0.8853455781936646, -1.1387362480163574, " \
                 "-0.39432501792907715, -0.030329735949635506, -0.6680875420570374, -0.10619702190160751, " \
                 "-0.03723418712615967, 0.3495481312274933, 0.46597418189048767, -1.0788875818252563, " \
                 "0.5069441795349121, -0.40278512239456177, -0.3970675766468048, 1.0237928628921509, " \
                 "-1.0276631116867065, -0.8096601366996765, 0.4378613233566284, -0.027812086045742035, " \
                 "-1.0001237392425537, 0.1029416024684906, 0.40451526641845703, -2.940967321395874, " \
                 "-0.27164527773857117, 0.3107047975063324, 0.5906871557235718, -1.0412012338638306, " \
                 "0.6433987617492676, -0.6718564629554749, -0.09632929414510727, 0.12877216935157776, " \
                 "0.9469826221466064, 0.022906458005309105, -0.44410231709480286, 0.40677422285079956, " \
                 "0.9280508160591125, -0.9752640724182129, 0.19506336748600006, 0.3361274302005768, " \
                 "1.4205466508865356, 0.4007081985473633, 0.34991219639778137, -0.811947226524353, " \
                 "1.0739457607269287, -0.08243441581726074, 0.11703044921159744, 1.4099533557891846, " \
                 "-0.7852961421012878, -0.48143503069877625, -0.8972068428993225, 0.5751323699951172, " \
                 "0.5348206162452698, -0.18174296617507935, -0.23510129749774933, 0.8615679740905762, " \
                 "0.4915751516819, 0.4364924132823944, -0.7726263999938965, 1.0369168519973755, 0.6031867265701294, " \
                 "-0.3667091429233551, 0.6657179594039917, -0.7260869741439819, -0.4019106924533844, " \
                 "0.05030713230371475, -0.33400097489356995, -0.3036237955093384, -0.6625174880027771, " \
                 "-1.4832583665847778, 0.11457355320453644, -0.46068236231803894, -0.5516899824142456, " \
                 "0.0366586297750473, 0.5402384996414185, -0.8741148114204407, 0.23959162831306458, " \
                 "-0.410228967666626, 0.47206786274909973, 1.1237887144088745, 1.252509593963623, " \
                 "0.31348755955696106, 0.4901786744594574, 0.23131518065929413, 0.32908105850219727, " \
                 "0.6930037140846252, 0.060493431985378265, 0.05442808195948601, -0.9575719237327576, " \
                 "-0.9045296311378479, -1.2402112483978271, -0.7849189043045044, 0.8367719650268555, " \
                 "-0.07879842072725296, 1.3631997108459473, 0.11906604468822479, -0.8270569443702698, " \
                 "1.7413612604141235, 0.20780406892299652, -0.4070189893245697, -0.3815484046936035, " \
                 "0.5578516125679016, 0.5099952220916748, 0.07213526219129562, -0.350197434425354, 1.816014051437378, " \
                 "-0.12084154784679413, -0.36051687598228455, -0.015200612135231495, 0.3556966781616211, " \
                 "0.01465181540697813, -0.07043398171663284, -0.6014364361763, -0.3180793523788452, " \
                 "-0.6328065395355225, -0.21130767464637756, 0.5268062949180603, -0.4051940441131592, " \
                 "0.36057308316230774, -1.034787654876709, 0.4915338158607483, -0.7155412435531616, " \
                 "0.597739577293396, -1.1195557117462158, -1.2659605741500854, -0.6378706097602844, " \
                 "-0.15136964619159698, -0.593898594379425, 0.3590724766254425, -0.7016128897666931, " \
                 "0.011024976149201393, 0.898310124874115, 0.21830134093761444, -0.027398383244872093, " \
                 "-0.7844876646995544, 0.8277140855789185, -0.429222047328949, -0.8500348925590515, " \
                 "0.7115476727485657, 0.20204490423202515, 0.9365223050117493, 0.2266499400138855, " \
                 "0.1945042610168457, 0.1905643343925476, 0.10846488922834396, -0.4486648440361023, " \
                 "-0.5829465389251709, -0.42163002490997314, -0.18808379769325256, -0.5925104022026062, " \
                 "0.24211469292640686, -1.3094587326049805, 0.32128116488456726, -0.152786985039711, " \
                 "0.330130398273468, 1.085317850112915, -0.7658910155296326, 0.3880355954170227, " \
                 "-0.17950387299060822, -0.15107999742031097, -0.19273409247398376, 1.0676569938659668, " \
                 "-0.2964930236339569, -0.686033308506012, -0.24969230592250824, -0.3603481948375702, " \
                 "-0.9429242014884949, 0.32809004187583923, 1.2158753871917725, 0.12035050988197327, " \
                 "0.018862443044781685, 0.317351371049881, 0.2528841495513916, -0.036208655685186386, " \
                 "0.0606762133538723, -0.5288358330726624, -0.43087291717529297, 1.1642652750015259, " \
                 "0.9734095335006714, 0.18907414376735687, -0.5709105134010315, 1.0933877229690552, " \
                 "0.4513375461101532, -1.1157896518707275, 0.9737383127212524, -0.3106665313243866, " \
                 "0.1761694997549057, 0.17052492499351501, -0.520778238773346, 0.5310056209564209, " \
                 "-1.1598148345947266, -0.34252607822418213, -1.5057480335235596, 0.25157758593559265, " \
                 "0.4865059554576874, 0.9700746536254883, 0.974685549736023, 0.8919028639793396, 0.32608866691589355, " \
                 "0.829308807849884, -0.8730133175849915, -0.4114616811275482, 0.7431223392486572, " \
                 "-0.20164138078689575, -0.7045559883117676, 0.5466605424880981, -0.7024660110473633, " \
                 "-0.05135650560259819, -0.11894828826189041, 0.5328269600868225, -1.5612914562225342, " \
                 "0.01981223374605179, 0.9012373089790344, 0.0031666846480220556, 0.9680814743041992, " \
                 "0.568750262260437, -0.3762907087802887, -0.4550609290599823, -0.26908087730407715, " \
                 "0.0968562662601471, 0.4912688732147217, -0.2870153784751892, 0.04680998623371124, " \
                 "0.8899773955345154, 0.27426013350486755, -0.47634944319725037, 0.5837814211845398, " \
                 "-0.6255754232406616, 0.6241564154624939, -0.29938939213752747, 0.909920334815979, " \
                 "-0.13443855941295624, 0.4236372113227844, -0.40367788076400757, 0.5998603105545044, " \
                 "-0.2217656970024109, 0.3458641767501831, -0.99966961145401, 0.26273226737976074, " \
                 "-0.3263491690158844, 0.731261670589447, 0.05430208146572113, -0.10052727907896042, " \
                 "0.3782542049884796, -0.23235715925693512, -0.26051759719848633, 0.24279655516147614, " \
                 "0.158476322889328, -0.2722291052341461, -0.8756415843963623, -0.1404045671224594, " \
                 "-1.1223788261413574, 0.4068365693092346, -0.7357841730117798, 0.6343322992324829, " \
                 "-0.838943362236023, 0.9940415620803833, 0.7734745144844055, -0.539315938949585, " \
                 "0.10245596617460251, 0.1819090098142624, 0.27982354164123535, -0.38085493445396423, " \
                 "-0.03696285933256149, -0.6804227828979492, 0.16334864497184753, -0.7711688280105591, " \
                 "0.32057538628578186, -0.04334133490920067, -0.22509093582630157, -0.8673465251922607, " \
                 "0.26715612411499023, -0.9446729421615601, 0.3959963619709015, 0.2783985435962677, " \
                 "1.5351699590682983, -0.31065401434898376, -0.21421068906784058, -0.010165570303797722, " \
                 "-0.41618648171424866, -0.27796509861946106, 1.0272414684295654, -0.8983907103538513, " \
                 "0.34760117530822754, -0.8966999053955078, -0.41055768728256226, 0.6547454595565796, " \
                 "0.006821208633482456, 0.38690778613090515, 0.288719117641449, 0.41748443245887756, " \
                 "-0.3707393407821655, 0.05937352403998375, -0.6266273260116577, -0.038271836936473846, " \
                 "0.7710340619087219, -0.5499677062034607, 0.07197408378124237, -0.537295401096344, " \
                 "0.9373942017555237, 0.9024200439453125, -0.44569921493530273, -1.1472678184509277, " \
                 "0.5524736046791077, -1.5091317892074585, -0.5473101735115051, 0.7880081534385681, " \
                 "0.8291811347007751, -0.44858500361442566, 1.1228710412979126, -0.621184766292572, " \
                 "-0.3766644597053528, -0.0075172740034759045, -0.22989493608474731, 0.465730220079422, " \
                 "2.7535018920898438, -0.3064192831516266, 0.9647713303565979, -0.4428182542324066, " \
                 "-0.25610408186912537, -0.00574928754940629, -0.02147345244884491, -1.012029767036438, " \
                 "-0.5286480188369751, -0.11727700382471085, 1.7324910163879395, -0.7088298797607422, " \
                 "0.7796900272369385, 0.3881795108318329, -0.8485005497932434, 0.12898848950862885, 1.16302490234375, " \
                 "-0.3201827108860016, -0.3258132040500641, 2.0778024196624756, 0.3445848524570465, " \
                 "0.11782059818506241, -0.15136012434959412, 0.9344751834869385, 0.048215776681900024, " \
                 "-0.5858867764472961, 0.2926265299320221, -0.920850932598114, 0.7467355728149414, 1.156496524810791, " \
                 "-0.8066507577896118, 0.4792063534259796, -0.06510590761899948, 0.33051344752311707, " \
                 "-0.5885607004165649, 0.7894601821899414, -0.8108950257301331, -1.0073336362838745, " \
                 "0.36346203088760376, 0.23392468690872192, 1.0321520566940308, -0.3190584182739258, " \
                 "0.3000282645225525, 0.24620488286018372, -0.8457980751991272, 0.45276182889938354, " \
                 "0.8195636868476868, 0.761217474937439, -0.13510756194591522, 0.7547335624694824, " \
                 "-0.9525907635688782, -0.6704450249671936, -0.1071714237332344, -0.4576852023601532, " \
                 "0.7443075180053711, 0.5211899280548096, 0.05724349990487099, -0.10447672754526138, " \
                 "-0.5198391675949097, 0.8426241874694824, 1.2300626039505005, -0.9367508888244629, " \
                 "0.3219417929649353, -0.8865604400634766, -0.516379714012146, 0.6954622268676758, " \
                 "-0.4415550231933594, 1.1705431938171387, 0.7283573746681213, -0.37438783049583435, " \
                 "1.4523054361343384, -0.8546947240829468, 0.35458019375801086, 0.03613819181919098, " \
                 "-0.43308335542678833, 0.193990558385849, -0.5142515897750854, 0.24122515320777893, " \
                 "0.23468104004859924, -0.5071788430213928, -0.19583925604820251, 0.9807226657867432, " \
                 "0.19463127851486206, -0.6662449836730957, -1.006870985031128, -0.9125353097915649, " \
                 "0.15324388444423676, -0.13058392703533173, -0.12855684757232666, 1.0895609855651855, " \
                 "0.261649489402771, 0.47783249616622925, -0.6125720739364624, -0.07070634514093399, " \
                 "-0.4097285866737366, 0.5985350012779236, -0.24000701308250427, 0.2795689105987549, " \
                 "0.7801438570022583, 0.3962094485759735, -0.3128543198108673, 0.3231380879878998, " \
                 "0.021570296958088875, -0.6883434057235718, -0.07870494574308395, 1.0566271543502808, " \
                 "-0.6644833087921143, -0.03530840575695038, 0.8344427347183228, -0.5526272058486938, " \
                 "0.14072299003601074, -0.8897697925567627, -0.37513020634651184, 0.15226076543331146, " \
                 "0.31824159622192383, -0.028937533497810364, -0.3127371072769165, 0.09401828050613403, " \
                 "-0.7634251117706299, 0.8445953726768494, 0.1783813238143921, 0.8381571173667908, " \
                 "-0.01650787517428398, 1.2300410270690918, 1.1702948808670044, -0.5262778401374817, " \
                 "-0.46130895614624023, -0.9667811989784241, 0.5244260430335999, -0.5472210645675659, " \
                 "-0.5812330842018127, 0.8101312518119812, -0.6985539793968201, 0.1060372143983841, " \
                 "0.3945245146751404, 1.0696667432785034, -0.8514360785484314, -0.4383413791656494, " \
                 "-0.9573401808738708, -0.04136594012379646, 0.3206349313259125, 0.24193072319030762, " \
                 "0.08000942319631577, 0.8788613080978394, -0.6863468885421753, 0.08979539573192596, " \
                 "-0.5891017913818359, -0.46048665046691895, 1.3848940134048462, 1.031425952911377, " \
                 "-0.8947393894195557, -0.5458812713623047, 0.7244054675102234, 0.41309353709220886, " \
                 "0.8036653399467468, 0.28643301129341125, -0.24244599044322968, -0.34960708022117615, " \
                 "0.009655741043388844, -0.34641432762145996, 1.020524501800537, 0.10685189813375473, " \
                 "0.36455485224723816, -0.16086411476135254, -0.05073893815279007, 0.15784130990505219, " \
                 "-0.6716392040252686, 0.4586796462535858, -0.5058237314224243, 0.8275198936462402, " \
                 "0.04514302313327789, 0.7063621282577515, -0.10484018921852112, 0.4782160520553589, " \
                 "0.998460054397583, 0.6854665279388428, 0.0678551197052002, 0.5618144273757935, 0.2146121710538864, " \
                 "-0.7898266315460205, -1.961232304573059, 0.6743036508560181, -0.6467500925064087, " \
                 "1.0388665199279785, -0.8960121870040894, 1.0529483556747437, 0.3134777247905731, 0.846454381942749, " \
                 "-0.18505048751831055, 0.4565025866031647, -0.18520022928714752, 0.5403355956077576, " \
                 "-0.1591004580259323, 0.6730515360832214, -0.7698886394500732, 0.2350311279296875, " \
                 "-0.5258981585502625, 0.08941883593797684, 0.7032075524330139, 0.9964777827262878, " \
                 "-0.2600826621055603, 1.8191642761230469, -0.3776562511920929, -0.15760596096515656, " \
                 "0.4205208122730255, -0.5728862285614014, -0.6767539978027344, 0.41983315348625183, " \
                 "0.22535201907157898, 1.1307694911956787, -0.7701322436332703, -0.8025346398353577, " \
                 "-0.0308812465518713, -0.31196585297584534, 1.5381801128387451, -0.3283883035182953, " \
                 "0.5605352520942688], [0.2679418623447418, -0.24267365038394928, -0.24049635231494904, " \
                 "0.5383989214897156, 0.21435841917991638, 0.4336371123790741, 0.4918113350868225, " \
                 "0.0408356674015522, 0.8330317139625549, -0.5947842001914978, 0.30135950446128845, " \
                 "0.6664566993713379, 0.019187113270163536, -0.7221309542655945, 0.23932109773159027, " \
                 "-0.28977543115615845, 0.8943020105361938, 0.6437888145446777, -0.05928656458854675, " \
                 "0.403577983379364, -0.35632625222206116, 0.8474694490432739, 0.32581233978271484, " \
                 "-0.32130157947540283, 0.04472416639328003, -0.2703309655189514, -0.722086489200592, " \
                 "0.4405486583709717, 1.61089289188385, -0.3029761016368866, 0.3361799418926239, -1.3366620540618896, " \
                 "1.0673211812973022, -0.5210212469100952, -0.8695799112319946, -0.2506885826587677, " \
                 "0.1776183396577835, -0.34000590443611145, -0.2216874063014984, 0.41742977499961853, " \
                 "1.2403485774993896, -0.08032684028148651, -0.42027270793914795, -0.2668399214744568, " \
                 "-0.6126906871795654, 0.29026955366134644, 0.359514445066452, -0.19671353697776794, " \
                 "0.8143911361694336, 0.09988090395927429, 0.758156418800354, 1.660152554512024, 0.2722342014312744, " \
                 "-0.7205333709716797, 0.7922757267951965, 1.2982089519500732, -0.27249622344970703, " \
                 "-1.3636294603347778, -0.007192809600383043, -0.5402860641479492, 1.127414345741272, " \
                 "-0.3265936076641083, -0.9081569314002991, 0.27461275458335876, 0.5897316932678223, " \
                 "-0.3771754503250122, -0.3511192202568054, 0.7905543446540833, 1.394981026649475, " \
                 "-0.9092658162117004, 0.7907884120941162, -0.8524738550186157, -0.17765001952648163, " \
                 "1.0525579452514648, 0.2541833221912384, -0.8155401945114136, -0.5528444647789001, " \
                 "-6.218643665313721, -0.38183465600013733, -0.4544784724712372, -0.9219051599502563, " \
                 "0.3732704520225525, 1.723412036895752, 0.6679298281669617, 0.3196019232273102, 0.42099252343177795, " \
                 "0.8414430022239685, 0.4514386057853699, 0.07603469491004944, -0.6980836987495422, " \
                 "0.18031319975852966, 0.7888243794441223, 0.33376699686050415, 0.14590349793434143, " \
                 "1.1597152948379517, -0.18737134337425232, 0.19511596858501434, 0.9916207790374756, " \
                 "-0.592937707901001, 0.38196009397506714, -0.0825701504945755, 0.021823998540639877, " \
                 "-1.015592098236084, -0.8963518738746643, -0.7028740048408508, 0.8163802027702332, " \
                 "-0.2790457308292389, -0.06482885777950287, -0.6694754362106323, 0.3046802282333374, " \
                 "1.044119954109192, 0.5819336771965027, 2.774291169771459e-05, 1.00865638256073, 0.7271277904510498, " \
                 "0.3819136917591095, 0.28354987502098083, -0.30859383940696716, 1.0123460292816162, " \
                 "0.5129196047782898, 0.170012429356575, -0.24021857976913452, -1.4384063482284546, " \
                 "0.6644861102104187, -0.07632841914892197, 0.6139011979103088, 0.5608202219009399, " \
                 "0.5479050278663635, 0.1041971817612648, 1.1445720195770264, 0.2637900114059448, -1.411919116973877, " \
                 "-0.3837966322898865, 0.5205994844436646, 0.8143910765647888, 0.9243167042732239, " \
                 "-0.06042997166514397, -0.09421626478433609, 0.4243980944156647, 1.359049677848816, " \
                 "-0.6691097617149353, 1.1584099531173706, -0.4185594916343689, -0.6592462658882141, " \
                 "0.8179345726966858, -1.157991886138916, -0.34348517656326294, -0.6265049576759338, " \
                 "1.4200903177261353, -0.031765785068273544, -0.36987414956092834, 0.950072169303894, " \
                 "-0.09186282008886337, -0.05475914850831032, 1.054155945777893, -0.5508552193641663, " \
                 "-0.3143467903137207, 1.346901535987854, 0.9937069416046143, -0.09119181334972382, " \
                 "-0.39631929993629456, -0.23208285868167877, -0.4107740521430969, 0.818007230758667, " \
                 "0.6375064849853516, -0.2050514668226242, -0.948804497718811, 0.7985398769378662, " \
                 "0.13929352164268494, -0.2683939039707184, -0.9033920764923096, 1.2008674144744873, " \
                 "-0.15308964252471924, -0.17730146646499634, 0.618521511554718, 0.44374847412109375, " \
                 "0.057466283440589905, 0.6301185488700867, 0.7788321375846863, 0.648716390132904, " \
                 "-0.294089674949646, 0.33414551615715027, -0.8632344007492065, -0.08730892091989517, " \
                 "0.6662845015525818, -0.3875405490398407, 0.2129068821668625, 0.1491590142250061, " \
                 "0.005926425103098154, -0.8728817701339722, -0.4893152713775635, -0.2968641221523285, " \
                 "-0.0930175855755806, -0.6935635805130005, 0.3835963308811188, 0.5488629341125488, " \
                 "0.21140404045581818, -0.026616636663675308, -0.06923919916152954, -0.03439929708838463, " \
                 "0.8669268488883972, -0.37582728266716003, 1.2189661264419556, -0.2829686999320984, " \
                 "-0.1403338760137558, 0.1188679188489914, -0.1574086993932724, -0.5379825830459595, " \
                 "0.48417288064956665, -1.0422263145446777, -0.04468875005841255, -0.16624417901039124, " \
                 "-0.5861259698867798, 0.2840472459793091, -0.8337792158126831, 0.11732622236013412, " \
                 "-0.1558324247598648, -0.7924115061759949, -1.0904924869537354, 0.10405170917510986, " \
                 "0.6631959676742554, -1.2136318683624268, 0.24706019461154938, 1.383150577545166, " \
                 "0.7540280222892761, 0.6716825366020203, -0.0337044931948185, 0.3264489471912384, " \
                 "-0.4544697105884552, -0.5980256795883179, -0.37117913365364075, -1.356473445892334, " \
                 "-1.6157891750335693, 0.6133245825767517, 0.22159679234027863, 2.2765233516693115, " \
                 "-0.4892977476119995, -0.272077351808548, -0.9377744197845459, -1.2208988666534424, " \
                 "-0.2788264751434326, -0.08529004454612732, -0.6871640086174011, -0.11838147044181824, " \
                 "-0.07380445301532745, 0.30191418528556824, 0.4893268644809723, -1.3103636503219604, " \
                 "0.6390020251274109, -0.42003732919692993, -0.3925514817237854, 0.9310523867607117, " \
                 "-1.1650307178497314, -0.699898362159729, 0.5966892838478088, -0.1450200229883194, " \
                 "-1.0122488737106323, 0.06597110629081726, 0.4098404347896576, -2.9340929985046387, " \
                 "-0.2171453982591629, 0.19802145659923553, 0.8064402341842651, -1.1679449081420898, " \
                 "0.6811426281929016, -0.6342366337776184, -0.11714135855436325, 0.14013062417507172, " \
                 "0.969855010509491, -0.026552708819508553, -0.39073070883750916, 0.408018559217453, " \
                 "0.9720187783241272, -1.077601432800293, 0.2582550048828125, 0.2864655554294586, 1.1305911540985107, " \
                 "0.3743210434913635, 0.16466838121414185, -0.9212854504585266, 1.0808707475662231, " \
                 "-0.24609561264514923, 0.04670611768960953, 1.427319884300232, -0.8084318041801453, " \
                 "-0.6685331463813782, -0.9138738512992859, 0.5097658634185791, 0.4970047175884247, " \
                 "-0.1134122684597969, -0.19823101162910461, 0.9693862199783325, 0.38382571935653687, " \
                 "0.39136946201324463, -0.842435359954834, 1.0920462608337402, 0.6948752403259277, " \
                 "-0.3073751926422119, 0.7441153526306152, -0.8657430410385132, -0.38018906116485596, " \
                 "0.11244949698448181, -0.18070140480995178, -0.2776462733745575, -0.6654195785522461, " \
                 "-1.4315125942230225, 0.13198606669902802, -0.4958341717720032, -0.36555686593055725, " \
                 "0.21024106442928314, 0.49710509181022644, -0.9093647599220276, 0.26727229356765747, " \
                 "-0.37317362427711487, 0.4766468405723572, 1.2423408031463623, 1.330812931060791, " \
                 "0.4090525209903717, 0.4578670263290405, 0.2652875483036041, 0.44351351261138916, " \
                 "0.6797385811805725, 0.17018038034439087, -0.11777620017528534, -0.8491030335426331, " \
                 "-0.8842570781707764, -1.2832449674606323, -0.7996892333030701, 0.88468998670578, " \
                 "0.06694187223911285, 1.5963832139968872, -0.19568732380867004, -0.7904404401779175, " \
                 "1.9107050895690918, 0.3195992112159729, -0.4002009630203247, -0.43849509954452515, " \
                 "0.7095561623573303, 0.504284143447876, 0.10113686323165894, -0.32115674018859863, " \
                 "1.7738078832626343, -0.14309866726398468, -0.3777807950973511, 0.055941469967365265, " \
                 "0.30077752470970154, 0.06805741786956787, -0.11397571861743927, -0.6621858477592468, " \
                 "-0.3160620331764221, -0.6241158843040466, -0.37108516693115234, 0.6162233352661133, " \
                 "-0.31501153111457825, 0.3773416578769684, -0.9763330221176147, 0.5656120777130127, " \
                 "-0.7327551245689392, 0.6356120705604553, -1.207686185836792, -1.4672857522964478, " \
                 "-0.5907036662101746, -0.12137825042009354, -0.5279437899589539, 0.2938518226146698, " \
                 "-0.4159342050552368, -0.018202830106019974, 1.009584665298462, 0.17675131559371948, " \
                 "0.024341365322470665, -0.9138460755348206, 0.9304447770118713, -0.36651429533958435, " \
                 "-0.8018720149993896, 0.5752859711647034, 0.2500929832458496, 1.1146082878112793, " \
                 "0.19238877296447754, 0.16362689435482025, 0.2855292558670044, 0.06446696072816849, " \
                 "-0.42228394746780396, -0.5256802439689636, -0.36742013692855835, -0.2674896717071533, " \
                 "-0.7569811940193176, 0.25198695063591003, -1.4124319553375244, 0.5761311650276184, " \
                 "-0.16616863012313843, 0.49869146943092346, 1.1880192756652832, -0.8593583703041077, " \
                 "0.47366398572921753, -0.25704434514045715, -0.21439269185066223, -0.19841285049915314, " \
                 "0.9221651554107666, -0.34223777055740356, -0.7113531827926636, -0.2929646968841553, " \
                 "-0.4314590394496918, -1.0580710172653198, 0.4062856137752533, 1.3255337476730347, " \
                 "0.1425745189189911, 0.18006886541843414, 0.28255870938301086, 0.32119986414909363, " \
                 "0.0051916977390646935, 0.1436929553747177, -0.40547534823417664, -0.40210866928100586, " \
                 "1.1272884607315063, 1.0275883674621582, 0.2510899305343628, -0.47194769978523254, " \
                 "1.512330412864685, 0.48353859782218933, -1.1519856452941895, 1.0253616571426392, " \
                 "-0.41816771030426025, 0.15889793634414673, 0.18134349584579468, -0.465589314699173, " \
                 "0.6040738224983215, -1.1006810665130615, -0.19105570018291473, -1.5307666063308716, " \
                 "0.23002591729164124, 0.5589573383331299, 0.9109311103820801, 1.0555459260940552, " \
                 "0.8233252763748169, 0.2916397154331207, 1.0038340091705322, -0.9122695922851562, " \
                 "-0.47859910130500793, 0.7264876961708069, -0.1427335888147354, -0.8143123388290405, " \
                 "0.44855183362960815, -0.6958466172218323, 0.15418292582035065, -0.23185023665428162, " \
                 "0.4898284375667572, -1.6508384943008423, 0.07295843213796616, 0.8014775514602661, " \
                 "0.09284244477748871, 0.9507209658622742, 0.4244481921195984, -0.2665133774280548, " \
                 "-0.3862594962120056, -0.3352755308151245, 0.03873108699917793, 0.45252612233161926, " \
                 "-0.25906163454055786, 0.043926458805799484, 0.9055188894271851, 0.3409687280654907, " \
                 "-0.2999074161052704, 0.7691028714179993, -0.6341447234153748, 0.5969430804252625, " \
                 "-0.29179441928863525, 0.7550162672996521, -0.2787688374519348, 0.4907248914241791, " \
                 "-0.3099662661552429, 0.47940289974212646, -0.33267685770988464, 0.23703241348266602, " \
                 "-1.024989366531372, 0.30951613187789917, -0.3900262713432312, 0.7769317626953125, " \
                 "0.05890153720974922, -0.10474583506584167, 0.5560724139213562, -0.2633325755596161, " \
                 "-0.1592138111591339, 0.18643392622470856, 0.07368388026952744, -0.30485570430755615, " \
                 "-0.8969284892082214, -0.06843351572751999, -1.1061697006225586, 0.3597956895828247, " \
                 "-0.7698079943656921, 0.5994350910186768, -0.8402047753334045, 0.9298068284988403, " \
                 "0.6217789649963379, -0.565863847732544, 0.10430559515953064, 0.21204540133476257, " \
                 "0.09279698133468628, -0.45694562792778015, -0.037788935005664825, -0.7944038510322571, " \
                 "0.12923064827919006, -0.7782451510429382, 0.38496142625808716, 0.07349499315023422, " \
                 "-0.32123029232025146, -0.7562453150749207, 0.26918286085128784, -0.9199386239051819, " \
                 "0.37875819206237793, 0.0751291960477829, 1.6398872137069702, -0.3638499081134796, " \
                 "-0.18986180424690247, -0.014395028352737427, -0.4918939173221588, -0.3633772134780884, " \
                 "1.073903203010559, -0.8614510893821716, 0.40865376591682434, -1.1540652513504028, " \
                 "-0.3617055118083954, 0.6071934103965759, -0.029209276661276817, 0.3373359739780426, " \
                 "0.3862834572792053, 0.3276521861553192, -0.538077712059021, -0.07311873883008957, " \
                 "-0.7045533061027527, 0.019152985885739326, 0.7044047117233276, -0.5260353684425354, " \
                 "-0.03996400907635689, -0.7090900540351868, 0.9506849050521851, 1.0638047456741333, " \
                 "-0.2424367219209671, -1.2011220455169678, 0.43442028760910034, -1.7586629390716553, " \
                 "-0.46763965487480164, 0.8659711480140686, 0.7663851380348206, -0.3334994614124298, " \
                 "1.1867971420288086, -0.5487616658210754, -0.46557649970054626, 0.05320900306105614, " \
                 "-0.15574684739112854, 0.29804959893226624, 2.0862467288970947, -0.39411041140556335, " \
                 "1.0443527698516846, -0.33170464634895325, -0.2527940273284912, -0.05183536186814308, " \
                 "-0.08696110546588898, -0.965384840965271, -0.4967491626739502, -0.09277915954589844, " \
                 "2.1422340869903564, -0.7425208687782288, 0.8383840322494507, 0.4638644754886627, " \
                 "-0.8587687611579895, 0.2039521187543869, 1.1372931003570557, -0.2794967293739319, " \
                 "-0.3548777401447296, 2.2480971813201904, 0.13439200818538666, 0.20550309121608734, " \
                 "0.24752773344516754, 1.127950668334961, -0.03623145446181297, -0.7674925327301025, " \
                 "0.21201549470424652, -0.8965722322463989, 0.687025249004364, 1.4675555229187012, " \
                 "-0.7885273098945618, 0.4787268340587616, 0.012538508512079716, 0.3945545554161072, " \
                 "-0.6554235219955444, 0.7856556177139282, -0.795196533203125, -0.585102379322052, " \
                 "0.39786985516548157, 0.3915465474128723, 1.2098357677459717, -0.34493497014045715, " \
                 "0.2121574580669403, 0.2549159526824951, -0.8098891973495483, 0.47456246614456177, " \
                 "0.8933552503585815, 0.7275819778442383, -0.23310580849647522, 0.8144664764404297, " \
                 "-1.0490055084228516, -0.5431604981422424, -0.2735615670681, -0.49912771582603455, " \
                 "0.8303893804550171, 0.5930827260017395, 0.10880278795957565, -0.14233623445034027, " \
                 "-0.7296587824821472, 0.7396524548530579, 0.9952501654624939, -0.9719616174697876, " \
                 "0.1829058676958084, -0.8431719541549683, -0.5569732189178467, 0.7721752524375916, " \
                 "-0.47862935066223145, 1.2398139238357544, 0.786788284778595, -0.5419500470161438, " \
                 "1.4931951761245728, -0.6234279870986938, 0.4575110971927643, 0.05646853521466255, " \
                 "-0.5912020206451416, 0.12924149632453918, -0.6529298424720764, 0.10243266820907593, " \
                 "0.3894086182117462, -0.5204554200172424, -0.2560219466686249, 0.9587681293487549, " \
                 "0.3504079282283783, -0.7388321161270142, -1.1332181692123413, -0.873205840587616, " \
                 "0.20708651840686798, -0.18978942930698395, -0.0764501765370369, 1.0266225337982178, " \
                 "0.4086206257343292, 0.4315522611141205, -0.7239729762077332, -0.0527934767305851, " \
                 "-0.4112669825553894, 0.7487188577651978, -0.08908269554376602, 0.2833316922187805, " \
                 "0.6577348113059998, 0.4266667068004608, -0.5612958073616028, 0.3303817808628082, " \
                 "0.07537835091352463, -0.8322713971138, -0.07162604480981827, 1.050524115562439, " \
                 "-0.6199507713317871, -0.2078264355659485, 0.7741559743881226, -0.6048350930213928, " \
                 "0.0888281837105751, -0.9019082188606262, -0.36655154824256897, 0.1871849000453949, " \
                 "0.3217826783657074, 0.11242613941431046, -0.3209380507469177, 0.25445181131362915, " \
                 "-0.7835785746574402, 1.137465476989746, 0.2520350217819214, 0.8422487378120422, " \
                 "0.04243834316730499, 1.136773943901062, 1.207245111465454, -0.48648327589035034, " \
                 "-0.5285760164260864, -0.8708872199058533, 0.3545558452606201, -0.6165609955787659, " \
                 "-0.6013278365135193, 0.8888952136039734, -0.671051025390625, 0.22234871983528137, " \
                 "0.336452454328537, 1.1354862451553345, -0.8606262803077698, -0.34966108202934265, " \
                 "-0.8165522813796997, -0.10757317394018173, 0.4990159273147583, 0.32681626081466675, " \
                 "0.0471561998128891, 0.9725205302238464, -0.7270833849906921, 0.017097042873501778, " \
                 "-0.5145735740661621, -0.4274694621562958, 1.402840495109558, 1.2123664617538452, " \
                 "-0.7906444668769836, -0.57884681224823, 0.5116679668426514, 0.40071406960487366, " \
                 "0.6945135593414307, 0.22780179977416992, -0.20983782410621643, -0.2945108413696289, " \
                 "-0.03485729545354843, -0.40423551201820374, 1.1143070459365845, 0.21375088393688202, " \
                 "0.49550119042396545, -0.11633432656526566, -0.05436692386865616, 0.3143255114555359, " \
                 "-0.7242588996887207, 0.3661445081233978, -0.47941648960113525, 0.9109966158866882, " \
                 "0.023181073367595673, 0.7545217871665955, -0.17455503344535828, 0.4848390221595764, " \
                 "1.1009658575057983, 0.9554244875907898, 0.15503691136837006, 0.6844443082809448, " \
                 "0.0880059078335762, -0.8798251152038574, -1.9128512144088745, 0.8988198041915894, " \
                 "-0.7177807092666626, 1.0528404712677002, -1.1032099723815918, 1.1793161630630493, " \
                 "0.3598674535751343, 0.9227380752563477, -0.07481475174427032, 0.48906275629997253, " \
                 "-0.3899226486682892, 0.5983114838600159, -0.21790270507335663, 0.7722501158714294, " \
                 "-0.8206437230110168, 0.259033739566803, -0.38096728920936584, 0.14698030054569244, " \
                 "0.6862068772315979, 1.0203843116760254, -0.2804830074310303, 1.58597731590271, " \
                 "-0.28472834825515747, 0.007751138415187597, 0.41977059841156006, -0.5788662433624268, " \
                 "-0.6717544198036194, 0.5106639862060547, 0.30552467703819275, 1.300943374633789, " \
                 "-0.7898303866386414, -0.8295242190361023, -0.07857048511505127, -0.26519376039505005, " \
                 "1.7459608316421509, -0.21424171328544617, 0.41849014163017273]]}"

        model_class = ModelST(MODEL_ROOT)
        response_answer = model_class.encode("123", DATA_TEST_SINGLE_TEXT, 'deepset/roberta-base-squad2')
        self.assertEqual(str(response_answer), answer)
        shutil.rmtree(MODEL_ROOT)


if __name__ == '__main__':
    unittest.main()
